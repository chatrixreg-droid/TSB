-- // ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò \\ --
local API_URL = "http://95.81.99.228:3000/brainrot/latest"
local PLACE_ID = 109983668079237 
local CFG_FILE = "MoonLogs_v27_Fixed.json"

-- // ‚ö° –ù–ê–°–¢–†–û–ô–ö–ò –¢–ï–õ–ï–ü–û–†–¢–ê (TURBO) \\ --
local TP_ATTEMPTS = 15
local TP_SPEED = 0

-- // üïí –ù–ê–°–¢–†–û–ô–ö–ê –ó–ê–î–ï–†–ñ–ö–ò –í–ò–ó–£–ê–õ–ê \\ --
local GUI_DELAY = 0.5 

-- // üõ† –°–ï–†–í–ò–°–´ \\ --
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local GuiService = game:GetService("GuiService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer

-- // üíæ –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï \\ --
local LockedJobs = {} 
local IsSpamming = false 
local LastCheckedID = "" 

-- // üíæ –°–û–•–†–ê–ù–ï–ù–ò–ï \\ --
local Settings = {
    MasterEnabled = false, 
    AutoOrange = false,     
    AutoRed = false,        
    FilterText = ""         
}

local function SaveConfig()
    if writefile then
        local dataToSave = {
            AutoOrange = Settings.AutoOrange,
            AutoRed = Settings.AutoRed,
            FilterText = Settings.FilterText
        }
        pcall(function()
            writefile(CFG_FILE, HttpService:JSONEncode(dataToSave))
        end)
    end
end

local function LoadConfig()
    if isfile and readfile and isfile(CFG_FILE) then
        pcall(function()
            local data = HttpService:JSONDecode(readfile(CFG_FILE))
            if data then
                if data.AutoOrange ~= nil then Settings.AutoOrange = data.AutoOrange end
                if data.AutoRed ~= nil then Settings.AutoRed = data.AutoRed end
                if data.FilterText ~= nil then Settings.FilterText = data.FilterText end
            end
        end)
    end
end

LoadConfig()

-- // üíé –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –ß–ò–°–ï–õ (–ö–†–ê–°–ò–í–û–ï) \\ --
local function FormatCompact(n)
    if not n then return "0" end
    if n >= 10^9 then
        return string.format("%.2fB", n / 10^9)
    elseif n >= 10^6 then
        return string.format("%.1fM", n / 10^6)
    elseif n >= 10^3 then
        return string.format("%.1fK", n / 10^3)
    else
        return tostring(n)
    end
end

-- // üïµÔ∏è STEALTH REQUEST \\ --
local function safeRequest(url)
    local noCacheUrl = url .. "?t=" .. tostring(tick())
    local success, result = pcall(function() return game:HttpGet(noCacheUrl) end)
    if success and result then return result end
    
    local fallback = (syn and syn.request) or (http and http.request) or http_request or request
    if fallback then
        local response = fallback({Url = noCacheUrl, Method = "GET"})
        if response and response.Body then return response.Body end
    end
    return nil
end

local function ParseValue(str)
    if type(str) ~= "string" or str == "" then return 0 end
    str = str:lower()
    local num = tonumber(str:match("[%d%.]+")) or 0
    if str:find("b") then num = num * 1000000000
    elseif str:find("m") then num = num * 1000000
    elseif str:find("k") then num = num * 1000 end
    return num
end

local function GetRealValue(entry)
    if entry.objects and entry.objects[1] and entry.objects[1].gen then
        return entry.objects[1].gen
    end
    if entry.range and entry.range.min then
        return entry.range.min
    end
    return 0
end

local function GetColorType(val)
    -- FIX: –ù–µ–º–Ω–æ–≥–æ —Å–Ω–∏–∂–µ–Ω –ø–æ—Ä–æ–≥ –¥–ª—è Medium (Orange), —á—Ç–æ–±—ã –ª–æ–≤–∏—Ç—å –±–æ–ª—å—à–µ —Å–µ—Ä–≤–µ—Ä–æ–≤
    if val >= 100000000 then -- 100M+
        return "Red", Color3.fromRGB(255, 60, 60)
    elseif val >= 20000000 then -- 20M+ (–ë—ã–ª–æ 30M, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è Medium)
        return "Orange", Color3.fromRGB(255, 170, 0)
    else 
        return "Ignore", Color3.fromRGB(80, 80, 80)
    end
end

-- // GUI SETUP \\ --
if game.CoreGui:FindFirstChild("MoonLogsMaster") then game.CoreGui.MoonLogsMaster:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MoonLogsMaster"
ScreenGui.DisplayOrder = 10000
ScreenGui.IgnoreGuiInset = true 
ScreenGui.ResetOnSpawn = false
if pcall(function() local x = game.CoreGui end) then ScreenGui.Parent = game.CoreGui else ScreenGui.Parent = Player:WaitForChild("PlayerGui") end

-- MAIN FRAME
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainPanel"
MainFrame.Size = UDim2.new(0, 520, 0, 450)
MainFrame.Position = UDim2.new(0.5, -260, 0.5, -225)
MainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 12)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local MStroke = Instance.new("UIStroke")
MStroke.Color = Color3.fromRGB(40, 40, 40)
MStroke.Thickness = 1
MStroke.Parent = MainFrame

local MCorner = Instance.new("UICorner")
MCorner.CornerRadius = UDim.new(0, 10)
MCorner.Parent = MainFrame

-- HEADER
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 40)
Header.BackgroundColor3 = Color3.fromRGB(18, 18, 20)
Header.Parent = MainFrame
local HCorner = Instance.new("UICorner")
HCorner.CornerRadius = UDim.new(0, 10)
HCorner.Parent = Header
local HFix = Instance.new("Frame"); HFix.Size = UDim2.new(1,0,0,10); HFix.Position = UDim2.new(0,0,1,-10); HFix.BorderSizePixel=0; HFix.BackgroundColor3=Header.BackgroundColor3; HFix.Parent=Header

local Title = Instance.new("TextLabel")
Title.Text = "MOON LOGS üåô (Fixed)"
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 18
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1
Title.Size = UDim2.new(1, -20, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Header

-- CONTROLS
local Controls = Instance.new("Frame")
Controls.Size = UDim2.new(1, -24, 0, 85)
Controls.Position = UDim2.new(0, 12, 0, 50)
Controls.BackgroundTransparency = 1
Controls.Parent = MainFrame

-- BUTTONS STYLE
local function CreateStylishBtn(name, text, color, pos, size, parent)
    local btn = Instance.new("TextButton")
    btn.Name = name
    btn.Size = size
    btn.Position = pos
    btn.BackgroundColor3 = Color3.fromRGB(25, 25, 28)
    btn.Text = text
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 12
    btn.TextColor3 = Color3.fromRGB(200, 200, 200)
    btn.AutoButtonColor = false
    btn.Parent = parent
    
    local c = Instance.new("UICorner"); c.CornerRadius = UDim.new(0, 6); c.Parent = btn
    local s = Instance.new("UIStroke"); s.Color = Color3.fromRGB(50, 50, 50); s.Thickness = 1; s.ApplyStrokeMode = Enum.ApplyStrokeMode.Border; s.Parent = btn
    return btn
end

local MasterBtn = CreateStylishBtn("Master", "AUTO: OFF", nil, UDim2.new(0,0,0,0), UDim2.new(0, 130, 0, 35), Controls)
local ClearBtn = CreateStylishBtn("Clear", "CLEAR LIST", nil, UDim2.new(0,140,0,0), UDim2.new(0, 100, 0, 35), Controls)

local FilterBox = Instance.new("TextBox")
FilterBox.PlaceholderText = "Min (e.g. 50m)"
FilterBox.Text = Settings.FilterText
FilterBox.Size = UDim2.new(0, 120, 0, 35)
FilterBox.Position = UDim2.new(1, -120, 0, 0)
FilterBox.BackgroundColor3 = Color3.fromRGB(20, 20, 22)
FilterBox.TextColor3 = Color3.fromRGB(255, 255, 255)
FilterBox.Font = Enum.Font.GothamBold
FilterBox.TextSize = 12
FilterBox.Parent = Controls
local FCorner = Instance.new("UICorner"); FCorner.CornerRadius = UDim.new(0, 6); FCorner.Parent = FilterBox
local FStroke = Instance.new("UIStroke"); FStroke.Color = Color3.fromRGB(50, 50, 50); FStroke.Parent = FilterBox

-- FILTERS ROW
local BtnOrange = CreateStylishBtn("Orange", "üî∏ MEDIUM (20M+)", nil, UDim2.new(0,0,0,45), UDim2.new(0.48, 0, 0, 30), Controls)
local BtnRed = CreateStylishBtn("Red", "üî• HIGH (100M+)", nil, UDim2.new(0.52,0,0,45), UDim2.new(0.48, 0, 0, 30), Controls)

-- SCROLL
local LogsScroll = Instance.new("ScrollingFrame")
LogsScroll.Size = UDim2.new(1, -24, 1, -150)
LogsScroll.Position = UDim2.new(0, 12, 0, 140)
LogsScroll.BackgroundTransparency = 1
LogsScroll.ScrollBarThickness = 3
LogsScroll.ScrollBarImageColor3 = Color3.fromRGB(60, 60, 60)
LogsScroll.Parent = MainFrame

local LogsLayout = Instance.new("UIListLayout")
LogsLayout.Padding = UDim.new(0, 8)
LogsLayout.SortOrder = Enum.SortOrder.LayoutOrder
LogsLayout.Parent = LogsScroll

-- // –õ–û–ì–ò–ö–ê GUI \\ --
local currentMinFilter = ParseValue(Settings.FilterText)

local function UpdateVisuals()
    if Settings.MasterEnabled then
        MasterBtn.Text = "AUTO: ON üöÄ"
        MasterBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 100)
        MasterBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        MasterBtn.UIStroke.Transparency = 1
    else
        MasterBtn.Text = "AUTO: OFF üõë"
        MasterBtn.BackgroundColor3 = Color3.fromRGB(25, 25, 28)
        MasterBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
        MasterBtn.UIStroke.Transparency = 0
    end

    local function setBtn(btn, state, color)
        if state then
            btn.BackgroundColor3 = Color3.fromRGB(25, 25, 28)
            btn.UIStroke.Color = color
            btn.UIStroke.Thickness = 2
            btn.TextColor3 = color
        else
            btn.BackgroundColor3 = Color3.fromRGB(20, 20, 22)
            btn.UIStroke.Color = Color3.fromRGB(40, 40, 40)
            btn.UIStroke.Thickness = 1
            btn.TextColor3 = Color3.fromRGB(100, 100, 100)
        end
    end
    setBtn(BtnOrange, Settings.AutoOrange, Color3.fromRGB(255, 170, 0))
    setBtn(BtnRed, Settings.AutoRed, Color3.fromRGB(255, 60, 60))
end

MasterBtn.MouseButton1Click:Connect(function() Settings.MasterEnabled = not Settings.MasterEnabled; UpdateVisuals() end)
BtnOrange.MouseButton1Click:Connect(function() Settings.AutoOrange = not Settings.AutoOrange; UpdateVisuals(); SaveConfig() end)
BtnRed.MouseButton1Click:Connect(function() Settings.AutoRed = not Settings.AutoRed; UpdateVisuals(); SaveConfig() end)
ClearBtn.MouseButton1Click:Connect(function() for _, v in pairs(LogsScroll:GetChildren()) do if v:IsA("Frame") then v:Destroy() end end end)

FilterBox.FocusLost:Connect(function()
    Settings.FilterText = FilterBox.Text
    currentMinFilter = ParseValue(FilterBox.Text)
    SaveConfig()
end)
UpdateVisuals()

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.RightShift then MainFrame.Visible = not MainFrame.Visible end
end)

-- // üî• SPAMMER LOGIC üî• \\ --
task.spawn(function()
    while true do
        local hasJobs = false
        for k, v in pairs(LockedJobs) do hasJobs = true break end

        if IsSpamming and hasJobs then
            for jobId, _ in pairs(LockedJobs) do
                TeleportService:TeleportToPlaceInstance(PLACE_ID, jobId, Player)
                task.wait() 
            end
        else
            task.wait(0.1)
        end
    end
end)

-- // ‚ú® –ö–†–ê–°–ò–í–ê–Ø –ö–ê–†–¢–û–ß–ö–ê ‚ú® // --
local function CreateLogCard(entry, forcedOrder)
    local val = GetRealValue(entry)
    local colorType, themeColor = GetColorType(val)
    
    if colorType == "Ignore" then return end

    local Card = Instance.new("Frame")
    Card.Size = UDim2.new(1, 0, 0, 60)
    Card.BackgroundColor3 = Color3.fromRGB(18, 18, 20)
    Card.BorderSizePixel = 0
    Card.LayoutOrder = forcedOrder
    Card.Parent = LogsScroll
    
    local CCorner = Instance.new("UICorner"); CCorner.CornerRadius = UDim.new(0, 8); CCorner.Parent = Card
    local CStroke = Instance.new("UIStroke"); CStroke.Color = Color3.fromRGB(35, 35, 35); CStroke.Parent = Card
    
    local itemName = (entry.objects and entry.objects[1] and entry.objects[1].name) or entry.title or "Unknown Item"

    -- Color Strip (Left)
    local Strip = Instance.new("Frame")
    Strip.Size = UDim2.new(0, 4, 1, 0)
    Strip.BackgroundColor3 = themeColor
    Strip.BorderSizePixel = 0
    Strip.Parent = Card
    local SCor = Instance.new("UICorner"); SCor.CornerRadius = UDim.new(0, 4); SCor.Parent = Strip
    
    -- Title (Name)
    local NameLbl = Instance.new("TextLabel")
    NameLbl.Text = itemName
    NameLbl.Font = Enum.Font.GothamBold
    NameLbl.TextSize = 13
    NameLbl.TextColor3 = Color3.fromRGB(220, 220, 220)
    NameLbl.BackgroundTransparency = 1
    NameLbl.Position = UDim2.new(0, 14, 0, 8)
    NameLbl.Size = UDim2.new(1, -150, 0, 15)
    NameLbl.TextXAlignment = Enum.TextXAlignment.Left
    NameLbl.TextTruncate = Enum.TextTruncate.AtEnd
    NameLbl.Parent = Card
    
    -- Price (BIG AND BEAUTIFUL)
    local PriceLbl = Instance.new("TextLabel")
    PriceLbl.Text = FormatCompact(val) .. "/s" 
    PriceLbl.Font = Enum.Font.GothamBlack
    PriceLbl.TextSize = 19
    PriceLbl.TextColor3 = Color3.fromRGB(255, 255, 255)
    PriceLbl.BackgroundTransparency = 1
    PriceLbl.Position = UDim2.new(0, 14, 0, 28)
    PriceLbl.Size = UDim2.new(0, 200, 0, 22)
    PriceLbl.TextXAlignment = Enum.TextXAlignment.Left
    PriceLbl.Parent = Card
    
    -- Gradient for Price
    local Gradient = Instance.new("UIGradient")
    Gradient.Rotation = 90
    if colorType == "Red" then
        Gradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 100, 100)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 50))
        }
    else
        Gradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 220, 100)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 150, 0))
        }
    end
    Gradient.Parent = PriceLbl
    
    -- JOIN BTN
    local JoinBtn = Instance.new("TextButton")
    JoinBtn.Text = "JOIN"
    JoinBtn.Font = Enum.Font.GothamBlack
    JoinBtn.TextSize = 11
    JoinBtn.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    JoinBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    JoinBtn.Size = UDim2.new(0, 60, 0, 32)
    JoinBtn.Position = UDim2.new(1, -70, 0.5, -16)
    JoinBtn.Parent = Card
    local JCor = Instance.new("UICorner"); JCor.CornerRadius = UDim.new(0, 6); JCor.Parent = JoinBtn
    local JStr = Instance.new("UIStroke"); JStr.Color = Color3.fromRGB(60, 60, 60); JStr.Parent = JoinBtn
    
    JoinBtn.MouseEnter:Connect(function() JoinBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 45) end)
    JoinBtn.MouseLeave:Connect(function() JoinBtn.BackgroundColor3 = Color3.fromRGB(25, 25, 30) end)

    JoinBtn.MouseButton1Click:Connect(function()
        if entry.jobId then TeleportService:TeleportToPlaceInstance(PLACE_ID, entry.jobId, Player) end
    end)

    -- LOCK BTN
    local LockBtn = Instance.new("TextButton")
    LockBtn.Font = Enum.Font.GothamBlack; LockBtn.TextSize = 11
    LockBtn.Size = UDim2.new(0, 50, 0, 32)
    LockBtn.Position = UDim2.new(1, -130, 0.5, -16)
    LockBtn.Parent = Card
    local LCor = Instance.new("UICorner"); LCor.CornerRadius = UDim.new(0, 6); LCor.Parent = LockBtn
    local LStr = Instance.new("UIStroke"); LStr.Parent = LockBtn

    local function setVisualState(locked)
        if locked then
            LockBtn.Text = "üõë"
            LockBtn.BackgroundColor3 = Color3.fromRGB(50, 20, 20)
            LockBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
            LStr.Color = Color3.fromRGB(200, 50, 50)
        else
            LockBtn.Text = "üîí"
            LockBtn.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
            LockBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
            LStr.Color = Color3.fromRGB(60, 60, 60)
        end
    end
    
    setVisualState(LockedJobs[entry.jobId] ~= nil)

    LockBtn.MouseButton1Click:Connect(function()
        if entry.jobId then
            if LockedJobs[entry.jobId] then
                LockedJobs[entry.jobId] = nil
                setVisualState(false)
            else
                LockedJobs[entry.jobId] = true
                IsSpamming = true 
                setVisualState(true)
            end
        end
    end)
end

-- // MAIN LOOP \\ --
task.spawn(function()
    local body = safeRequest(API_URL)
    if body then
        local success, data = pcall(function() return HttpService:JSONDecode(body) end)
        if success and data and data.entries and data.entries[1] then
            LastCheckedID = data.entries[1].jobId 
        end
    end
end)

local teleporting = false
local lastGuiUpdate = 0 

task.spawn(function()
    while true do
        task.wait() 
        local body = safeRequest(API_URL)
        if body then
            local success, data = pcall(function() return HttpService:JSONDecode(body) end)
            
            if success and data and data.entries then
                local entries = data.entries
                if #entries > 0 then
                    local newest = entries[1]
                    
                    if newest.jobId ~= LastCheckedID and not teleporting then
                        if Settings.MasterEnabled then
                            local val = GetRealValue(newest) 
                            local cType, _ = GetColorType(val)
                            local shouldJoin = false
                            
                            if cType == "Orange" and Settings.AutoOrange then shouldJoin = true end
                            if cType == "Red" and Settings.AutoRed then shouldJoin = true end
                            
                            if shouldJoin and val < currentMinFilter then shouldJoin = false end
                            
                            if shouldJoin then
                                LastCheckedID = newest.jobId
                                teleporting = true
                                
                                task.spawn(function()
                                    for i = 1, TP_ATTEMPTS do
                                        task.spawn(function()
                                            TeleportService:TeleportToPlaceInstance(PLACE_ID, newest.jobId, Player)
                                        end)
                                        if TP_SPEED > 0 then task.wait(TP_SPEED) end
                                    end
                                    task.wait(1.5) 
                                    teleporting = false
                                end)
                            else
                                LastCheckedID = newest.jobId
                            end
                        else
                            LastCheckedID = newest.jobId
                        end
                    end
                    
                    if MainFrame.Visible and (tick() - lastGuiUpdate >= GUI_DELAY) then
                        lastGuiUpdate = tick() 
                        for _, v in pairs(LogsScroll:GetChildren()) do if v:IsA("Frame") then v:Destroy() end end
                        
                        local displayedCount = 0
                        local maxLogsToShow = 15

                        for _, entry in ipairs(entries) do
                            local val = GetRealValue(entry) 
                            local cType, _ = GetColorType(val)
                            local show = false
                            
                            if cType ~= "Ignore" and val >= currentMinFilter then
                                if cType == "Orange" and Settings.AutoOrange then show = true end
                                if cType == "Red" and Settings.AutoRed then show = true end
                                if not Settings.AutoOrange and not Settings.AutoRed then show = true end
                            end

                            if show then
                                displayedCount = displayedCount + 1
                                CreateLogCard(entry, displayedCount)
                            end
                            if displayedCount >= maxLogsToShow then break end
                        end
                        LogsScroll.CanvasSize = UDim2.new(0, 0, 0, displayedCount * 68) 
                    end
                end
            end
        end
    end
end)

-- // üî• ANTI-ERROR & RECONNECT (–¢–í–û–ô –ó–ê–ü–†–û–°) üî• \\ --
task.spawn(function()
    while true do
        game:GetService('GuiService'):ClearError()
        task.wait(0.000000000000001) -- Waits for 0 seconds before repeating the loop
    end
end)
